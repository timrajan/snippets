Prompt for Backend Team: Full Test Report Artifact Storage                                                                                                                                                     
                                                                                                                                                                                                                 
  Overview                                                                                                                                                                                                       
                                                                                                                                                                                                                 
  We need to extend the test reports API to store complete test execution data including step-by-step details and screenshots. This enables users to view full test reports from any machine after logging in.   
                                                                                                                                                                                                                 
  Requirements:                                                                                                                                                                                                  
  - Local file storage on the server (no cloud/S3)                                                                                                                                                               
  - Screenshots will be compressed (PNG) before upload                                                                                                                                                           
  - Sync happens immediately after each test completes                                                                                                                                                           
  - Indefinite retention (no auto-deletion)                                                                                                                                                                      
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
  Database Schema                                                                                                                                                                                                
                                                                                                                                                                                                                 
  Table 1: test_step_results                                                                                                                                                                                     
                                                                                                                                                                                                                 
  Stores individual step execution details for each test case.                                                                                                                                                   
                                                                                                                                                                                                                 
  CREATE TABLE test_step_results (                                                                                                                                                                               
      id UUID PRIMARY KEY DEFAULT gen_random_uuid(),                                                                                                                                                             
      test_case_result_id UUID NOT NULL REFERENCES test_case_results(id) ON DELETE CASCADE,                                                                                                                      
      step_number INTEGER NOT NULL,                                                                                                                                                                              
      step_type VARCHAR(50) NOT NULL,          -- 'click', 'type', 'assert', 'navigate', 'wait', 'screenshot', 'scroll', 'select', 'hover', 'drag_drop', 'execute_script', 'switch_frame', 'switch_window',      
  'accept_alert', 'dismiss_alert', 'upload_file'                                                                                                                                                                 
      action VARCHAR(100),                      -- Human readable action like "Click on Login Button"                                                                                                            
      description TEXT,                         -- Detailed description                                                                                                                                          
      status VARCHAR(20) NOT NULL DEFAULT 'Pending',  -- 'Passed', 'Failed', 'Skipped', 'Pending'                                                                                                                
      duration_ms INTEGER,                                                                                                                                                                                       
                                                                                                                                                                                                                 
      -- Element information                                                                                                                                                                                     
      element_selector TEXT,                    -- CSS/XPath selector                                                                                                                                            
      element_name VARCHAR(255),                -- Friendly element name                                                                                                                                         
      element_type VARCHAR(50),                 -- button, input, link, etc.                                                                                                                                     
                                                                                                                                                                                                                 
      -- Input/Output                                                                                                                                                                                            
      input_value TEXT,                         -- Value typed or selected                                                                                                                                       
      expected_value TEXT,                      -- For assertions                                                                                                                                                
      actual_value TEXT,                        -- For assertions                                                                                                                                                
                                                                                                                                                                                                                 
      -- Error details (if failed)                                                                                                                                                                               
      error_message TEXT,                                                                                                                                                                                        
      error_type VARCHAR(100),                                                                                                                                                                                   
      stack_trace TEXT,                                                                                                                                                                                          
                                                                                                                                                                                                                 
      -- Screenshot reference                                                                                                                                                                                    
      screenshot_artifact_id UUID,              -- Reference to test_artifacts table                                                                                                                             
                                                                                                                                                                                                                 
      -- Timestamps                                                                                                                                                                                              
      started_at TIMESTAMP WITH TIME ZONE,                                                                                                                                                                       
      completed_at TIMESTAMP WITH TIME ZONE,                                                                                                                                                                     
      created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,                                                                                                                                             
                                                                                                                                                                                                                 
      -- Indexes                                                                                                                                                                                                 
      CONSTRAINT unique_step_per_test UNIQUE (test_case_result_id, step_number)                                                                                                                                  
  );                                                                                                                                                                                                             
                                                                                                                                                                                                                 
  CREATE INDEX idx_step_results_test_case ON test_step_results(test_case_result_id);                                                                                                                             
  CREATE INDEX idx_step_results_status ON test_step_results(status);                                                                                                                                             
                                                                                                                                                                                                                 
  Table 2: test_artifacts                                                                                                                                                                                        
                                                                                                                                                                                                                 
  Stores metadata for uploaded files (screenshots, logs, etc.)                                                                                                                                                   
                                                                                                                                                                                                                 
  CREATE TABLE test_artifacts (                                                                                                                                                                                  
      id UUID PRIMARY KEY DEFAULT gen_random_uuid(),                                                                                                                                                             
      test_case_result_id UUID NOT NULL REFERENCES test_case_results(id) ON DELETE CASCADE,                                                                                                                      
                                                                                                                                                                                                                 
      -- File metadata                                                                                                                                                                                           
      artifact_type VARCHAR(50) NOT NULL,       -- 'screenshot', 'log', 'video', 'har', 'other'                                                                                                                  
      file_name VARCHAR(255) NOT NULL,          -- Original filename                                                                                                                                             
      file_size INTEGER NOT NULL,               -- Size in bytes                                                                                                                                                 
      mime_type VARCHAR(100) NOT NULL,          -- 'image/png', 'application/json', etc.                                                                                                                         
      checksum VARCHAR(64),                     -- SHA256 hash for integrity                                                                                                                                     
                                                                                                                                                                                                                 
      -- Storage location                                                                                                                                                                                        
      storage_path TEXT NOT NULL,               -- Relative path on server filesystem                                                                                                                            
                                                                                                                                                                                                                 
      -- Context                                                                                                                                                                                                 
      step_number INTEGER,                      -- Which step this artifact belongs to (nullable for test-level artifacts)                                                                                       
      iteration_number INTEGER DEFAULT 1,       -- For data-driven tests                                                                                                                                         
      artifact_category VARCHAR(50),            -- 'before', 'after', 'error', 'checkpoint'                                                                                                                      
      description TEXT,                                                                                                                                                                                          
                                                                                                                                                                                                                 
      -- Timestamps                                                                                                                                                                                              
      captured_at TIMESTAMP WITH TIME ZONE,     -- When the artifact was captured during test                                                                                                                    
      uploaded_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,                                                                                                                                            
      created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,                                                                                                                                             
                                                                                                                                                                                                                 
      CONSTRAINT unique_artifact_path UNIQUE (storage_path)                                                                                                                                                      
  );                                                                                                                                                                                                             
                                                                                                                                                                                                                 
  CREATE INDEX idx_artifacts_test_case ON test_artifacts(test_case_result_id);                                                                                                                                   
  CREATE INDEX idx_artifacts_type ON test_artifacts(artifact_type);                                                                                                                                              
  CREATE INDEX idx_artifacts_step ON test_artifacts(test_case_result_id, step_number);                                                                                                                           
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
  API Endpoints                                                                                                                                                                                                  
                                                                                                                                                                                                                 
  1. Upload Step Results (Bulk)                                                                                                                                                                                  
                                                                                                                                                                                                                 
  Endpoint: POST /api/v1/reports/test-case-results/{test_case_result_id}/steps                                                                                                                                   
                                                                                                                                                                                                                 
  Description: Upload all step results for a test case in a single request.                                                                                                                                      
                                                                                                                                                                                                                 
  Request Body:                                                                                                                                                                                                  
  {                                                                                                                                                                                                              
    "steps": [                                                                                                                                                                                                   
      {                                                                                                                                                                                                          
        "step_number": 1,                                                                                                                                                                                        
        "step_type": "navigate",                                                                                                                                                                                 
        "action": "Navigate to Login Page",                                                                                                                                                                      
        "description": "Opening https://example.com/login",                                                                                                                                                      
        "status": "Passed",                                                                                                                                                                                      
        "duration_ms": 1250,                                                                                                                                                                                     
        "element_selector": null,                                                                                                                                                                                
        "element_name": null,                                                                                                                                                                                    
        "element_type": null,                                                                                                                                                                                    
        "input_value": "https://example.com/login",                                                                                                                                                              
        "expected_value": null,                                                                                                                                                                                  
        "actual_value": null,                                                                                                                                                                                    
        "error_message": null,                                                                                                                                                                                   
        "error_type": null,                                                                                                                                                                                      
        "stack_trace": null,                                                                                                                                                                                     
        "started_at": "2026-01-24T12:00:00.000Z",                                                                                                                                                                
        "completed_at": "2026-01-24T12:00:01.250Z"                                                                                                                                                               
      },                                                                                                                                                                                                         
      {                                                                                                                                                                                                          
        "step_number": 2,                                                                                                                                                                                        
        "step_type": "type",                                                                                                                                                                                     
        "action": "Enter Username",                                                                                                                                                                              
        "description": "Typing username into email field",                                                                                                                                                       
        "status": "Passed",                                                                                                                                                                                      
        "duration_ms": 350,                                                                                                                                                                                      
        "element_selector": "#email-input",                                                                                                                                                                      
        "element_name": "Email Input",                                                                                                                                                                           
        "element_type": "input",                                                                                                                                                                                 
        "input_value": "testuser@example.com",                                                                                                                                                                   
        "expected_value": null,                                                                                                                                                                                  
        "actual_value": null,                                                                                                                                                                                    
        "error_message": null,                                                                                                                                                                                   
        "error_type": null,                                                                                                                                                                                      
        "stack_trace": null,                                                                                                                                                                                     
        "started_at": "2026-01-24T12:00:01.250Z",                                                                                                                                                                
        "completed_at": "2026-01-24T12:00:01.600Z"                                                                                                                                                               
      },                                                                                                                                                                                                         
      {                                                                                                                                                                                                          
        "step_number": 3,                                                                                                                                                                                        
        "step_type": "click",                                                                                                                                                                                    
        "action": "Click Login Button",                                                                                                                                                                          
        "description": "Clicking the submit button",                                                                                                                                                             
        "status": "Failed",                                                                                                                                                                                      
        "duration_ms": 5000,                                                                                                                                                                                     
        "element_selector": "button[type='submit']",                                                                                                                                                             
        "element_name": "Login Button",                                                                                                                                                                          
        "element_type": "button",                                                                                                                                                                                
        "input_value": null,                                                                                                                                                                                     
        "expected_value": null,                                                                                                                                                                                  
        "actual_value": null,                                                                                                                                                                                    
        "error_message": "Element not clickable: obscured by overlay",                                                                                                                                           
        "error_type": "ElementClickInterceptedException",                                                                                                                                                        
        "stack_trace": "Traceback (most recent call last):\n  File...",                                                                                                                                          
        "started_at": "2026-01-24T12:00:01.600Z",                                                                                                                                                                
        "completed_at": "2026-01-24T12:00:06.600Z"                                                                                                                                                               
      }                                                                                                                                                                                                          
    ]                                                                                                                                                                                                            
  }                                                                                                                                                                                                              
                                                                                                                                                                                                                 
  Response (201 Created):                                                                                                                                                                                        
  {                                                                                                                                                                                                              
    "message": "Successfully created 3 step results",                                                                                                                                                            
    "step_ids": [                                                                                                                                                                                                
      "a1b2c3d4-...",                                                                                                                                                                                            
      "b2c3d4e5-...",                                                                                                                                                                                            
      "c3d4e5f6-..."                                                                                                                                                                                             
    ],                                                                                                                                                                                                           
    "test_case_result_id": "uuid-of-test-case"                                                                                                                                                                   
  }                                                                                                                                                                                                              
                                                                                                                                                                                                                 
  Error Response (404):                                                                                                                                                                                          
  {                                                                                                                                                                                                              
    "detail": "Test case result not found"                                                                                                                                                                       
  }                                                                                                                                                                                                              
                                                                                                                                                                                                                 
  Error Response (409 Conflict - if steps already exist):                                                                                                                                                        
  {                                                                                                                                                                                                              
    "detail": "Steps already exist for this test case. Use PUT to update."                                                                                                                                       
  }                                                                                                                                                                                                              
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
  2. Get Step Results                                                                                                                                                                                            
                                                                                                                                                                                                                 
  Endpoint: GET /api/v1/reports/test-case-results/{test_case_result_id}/steps                                                                                                                                    
                                                                                                                                                                                                                 
  Query Parameters:                                                                                                                                                                                              
  - status (optional): Filter by status (Passed, Failed, Skipped)                                                                                                                                                
  - include_artifacts (optional, default: true): Include artifact URLs in response                                                                                                                               
                                                                                                                                                                                                                 
  Response (200 OK):                                                                                                                                                                                             
  {                                                                                                                                                                                                              
    "test_case_result_id": "uuid-of-test-case",                                                                                                                                                                  
    "total_steps": 3,                                                                                                                                                                                            
    "passed_steps": 2,                                                                                                                                                                                           
    "failed_steps": 1,                                                                                                                                                                                           
    "skipped_steps": 0,                                                                                                                                                                                          
    "steps": [                                                                                                                                                                                                   
      {                                                                                                                                                                                                          
        "id": "step-uuid-1",                                                                                                                                                                                     
        "step_number": 1,                                                                                                                                                                                        
        "step_type": "navigate",                                                                                                                                                                                 
        "action": "Navigate to Login Page",                                                                                                                                                                      
        "description": "Opening https://example.com/login",                                                                                                                                                      
        "status": "Passed",                                                                                                                                                                                      
        "duration_ms": 1250,                                                                                                                                                                                     
        "element_selector": null,                                                                                                                                                                                
        "element_name": null,                                                                                                                                                                                    
        "element_type": null,                                                                                                                                                                                    
        "input_value": "https://example.com/login",                                                                                                                                                              
        "expected_value": null,                                                                                                                                                                                  
        "actual_value": null,                                                                                                                                                                                    
        "error_message": null,                                                                                                                                                                                   
        "screenshot": {                                                                                                                                                                                          
          "id": "artifact-uuid-1",                                                                                                                                                                               
          "url": "/api/v1/reports/artifacts/artifact-uuid-1/download",                                                                                                                                           
          "file_name": "step_001_navigate.png",                                                                                                                                                                  
          "file_size": 45678                                                                                                                                                                                     
        },                                                                                                                                                                                                       
        "started_at": "2026-01-24T12:00:00.000Z",                                                                                                                                                                
        "completed_at": "2026-01-24T12:00:01.250Z"                                                                                                                                                               
      },                                                                                                                                                                                                         
      {                                                                                                                                                                                                          
        "id": "step-uuid-2",                                                                                                                                                                                     
        "step_number": 2,                                                                                                                                                                                        
        "step_type": "type",                                                                                                                                                                                     
        "action": "Enter Username",                                                                                                                                                                              
        "description": "Typing username into email field",                                                                                                                                                       
        "status": "Passed",                                                                                                                                                                                      
        "duration_ms": 350,                                                                                                                                                                                      
        "element_selector": "#email-input",                                                                                                                                                                      
        "element_name": "Email Input",                                                                                                                                                                           
        "element_type": "input",                                                                                                                                                                                 
        "input_value": "testuser@example.com",                                                                                                                                                                   
        "expected_value": null,                                                                                                                                                                                  
        "actual_value": null,                                                                                                                                                                                    
        "error_message": null,                                                                                                                                                                                   
        "screenshot": {                                                                                                                                                                                          
          "id": "artifact-uuid-2",                                                                                                                                                                               
          "url": "/api/v1/reports/artifacts/artifact-uuid-2/download",                                                                                                                                           
          "file_name": "step_002_type.png",                                                                                                                                                                      
          "file_size": 52341                                                                                                                                                                                     
        },                                                                                                                                                                                                       
        "started_at": "2026-01-24T12:00:01.250Z",                                                                                                                                                                
        "completed_at": "2026-01-24T12:00:01.600Z"                                                                                                                                                               
      },                                                                                                                                                                                                         
      {                                                                                                                                                                                                          
        "id": "step-uuid-3",                                                                                                                                                                                     
        "step_number": 3,                                                                                                                                                                                        
        "step_type": "click",                                                                                                                                                                                    
        "action": "Click Login Button",                                                                                                                                                                          
        "description": "Clicking the submit button",                                                                                                                                                             
        "status": "Failed",                                                                                                                                                                                      
        "duration_ms": 5000,                                                                                                                                                                                     
        "element_selector": "button[type='submit']",                                                                                                                                                             
        "element_name": "Login Button",                                                                                                                                                                          
        "element_type": "button",                                                                                                                                                                                
        "input_value": null,                                                                                                                                                                                     
        "expected_value": null,                                                                                                                                                                                  
        "actual_value": null,                                                                                                                                                                                    
        "error_message": "Element not clickable: obscured by overlay",                                                                                                                                           
        "error_type": "ElementClickInterceptedException",                                                                                                                                                        
        "stack_trace": "Traceback...",                                                                                                                                                                           
        "screenshot": {                                                                                                                                                                                          
          "id": "artifact-uuid-3",                                                                                                                                                                               
          "url": "/api/v1/reports/artifacts/artifact-uuid-3/download",                                                                                                                                           
          "file_name": "step_003_click_error.png",                                                                                                                                                               
          "file_size": 67892                                                                                                                                                                                     
        },                                                                                                                                                                                                       
        "started_at": "2026-01-24T12:00:01.600Z",                                                                                                                                                                
        "completed_at": "2026-01-24T12:00:06.600Z"                                                                                                                                                               
      }                                                                                                                                                                                                          
    ]                                                                                                                                                                                                            
  }                                                                                                                                                                                                              
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
  3. Upload Artifact (Screenshot)                                                                                                                                                                                
                                                                                                                                                                                                                 
  Endpoint: POST /api/v1/reports/test-case-results/{test_case_result_id}/artifacts                                                                                                                               
                                                                                                                                                                                                                 
  Content-Type: multipart/form-data                                                                                                                                                                              
                                                                                                                                                                                                                 
  Form Fields:                                                                                                                                                                                                   
                                                                                                                            
         Field            Type      Required              Description                                                                                                                                       
                                                                                                                            
   file               File          Yes       The artifact file (PNG, JSON, etc.)                                                                                                                           
                                                                                                                            
   artifact_type      String        Yes       Type: screenshot, log, video, other                                                                                                                           
                                                                                                                            
   step_number        Integer       No        Which step this artifact belongs to                                                                                                                           
                                                                                                                            
   iteration_number   Integer       No        For data-driven tests (default: 1)                                                                                                                            
                                                                                                                            
   artifact_category  String        No        before, after, error, checkpoint                                                                                                                              
                                                                                                                            
   description        String        No        Human readable description                                                                                                                                    
                                                                                                                            
   captured_at        ISO DateTime  No        When artifact was captured                                                                                                                                    
                                                                                                                            
  Example curl:                                                                                                                                                                                                  
  curl -X POST \                                                                                                                                                                                                 
    "http://localhost:8000/api/v1/reports/test-case-results/{id}/artifacts" \                                                                                                                                    
    -H "Authorization: Bearer <token>" \                                                                                                                                                                         
    -F "file=@screenshot.png" \                                                                                                                                                                                  
    -F "artifact_type=screenshot" \                                                                                                                                                                              
    -F "step_number=1" \                                                                                                                                                                                         
    -F "artifact_category=after" \                                                                                                                                                                               
    -F "captured_at=2026-01-24T12:00:01.250Z"                                                                                                                                                                    
                                                                                                                                                                                                                 
  Response (201 Created):                                                                                                                                                                                        
  {                                                                                                                                                                                                              
    "id": "artifact-uuid",                                                                                                                                                                                       
    "test_case_result_id": "test-case-uuid",                                                                                                                                                                     
    "artifact_type": "screenshot",                                                                                                                                                                               
    "file_name": "screenshot.png",                                                                                                                                                                               
    "file_size": 45678,                                                                                                                                                                                          
    "mime_type": "image/png",                                                                                                                                                                                    
    "checksum": "sha256-hash",                                                                                                                                                                                   
    "storage_path": "artifacts/2026/01/24/test-case-uuid/step_001.png",                                                                                                                                          
    "step_number": 1,                                                                                                                                                                                            
    "iteration_number": 1,                                                                                                                                                                                       
    "artifact_category": "after",                                                                                                                                                                                
    "download_url": "/api/v1/reports/artifacts/artifact-uuid/download",                                                                                                                                          
    "uploaded_at": "2026-01-24T12:05:00.000Z"                                                                                                                                                                    
  }                                                                                                                                                                                                              
                                                                                                                                                                                                                 
  Error Response (413 Payload Too Large):                                                                                                                                                                        
  {                                                                                                                                                                                                              
    "detail": "File size exceeds maximum allowed (10MB)"                                                                                                                                                         
  }                                                                                                                                                                                                              
                                                                                                                                                                                                                 
  Error Response (415 Unsupported Media Type):                                                                                                                                                                   
  {                                                                                                                                                                                                              
    "detail": "File type not allowed. Allowed types: image/png, image/jpeg, application/json, text/plain"                                                                                                        
  }                                                                                                                                                                                                              
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
  4. Upload Multiple Artifacts (Batch)                                                                                                                                                                           
                                                                                                                                                                                                                 
  Endpoint: POST /api/v1/reports/test-case-results/{test_case_result_id}/artifacts/batch                                                                                                                         
                                                                                                                                                                                                                 
  Content-Type: multipart/form-data                                                                                                                                                                              
                                                                                                                                                                                                                 
  Form Fields:                                                                                                                                                                                                   
                                                                                                                                   
    Field       Type      Required               Description                                                                                                                                                
                                                                                                                                   
   files     File[]       Yes       Multiple files (up to 50)                                                                                                                                               
                                                                                                                                   
   metadata  JSON String  Yes       JSON array with metadata for each file                                                                                                                                  
                                                                                                                                   
  Metadata JSON Structure:                                                                                                                                                                                       
  [                                                                                                                                                                                                              
    {                                                                                                                                                                                                            
      "file_index": 0,                                                                                                                                                                                           
      "artifact_type": "screenshot",                                                                                                                                                                             
      "step_number": 1,                                                                                                                                                                                          
      "artifact_category": "after",                                                                                                                                                                              
      "captured_at": "2026-01-24T12:00:01.250Z"                                                                                                                                                                  
    },                                                                                                                                                                                                           
    {                                                                                                                                                                                                            
      "file_index": 1,                                                                                                                                                                                           
      "artifact_type": "screenshot",                                                                                                                                                                             
      "step_number": 2,                                                                                                                                                                                          
      "artifact_category": "after",                                                                                                                                                                              
      "captured_at": "2026-01-24T12:00:01.600Z"                                                                                                                                                                  
    }                                                                                                                                                                                                            
  ]                                                                                                                                                                                                              
                                                                                                                                                                                                                 
  Response (201 Created):                                                                                                                                                                                        
  {                                                                                                                                                                                                              
    "message": "Successfully uploaded 2 artifacts",                                                                                                                                                              
    "artifacts": [                                                                                                                                                                                               
      {                                                                                                                                                                                                          
        "id": "artifact-uuid-1",                                                                                                                                                                                 
        "file_name": "step_001.png",                                                                                                                                                                             
        "step_number": 1,                                                                                                                                                                                        
        "download_url": "/api/v1/reports/artifacts/artifact-uuid-1/download"                                                                                                                                     
      },                                                                                                                                                                                                         
      {                                                                                                                                                                                                          
        "id": "artifact-uuid-2",                                                                                                                                                                                 
        "file_name": "step_002.png",                                                                                                                                                                             
        "step_number": 2,                                                                                                                                                                                        
        "download_url": "/api/v1/reports/artifacts/artifact-uuid-2/download"                                                                                                                                     
      }                                                                                                                                                                                                          
    ],                                                                                                                                                                                                           
    "failed": []                                                                                                                                                                                                 
  }                                                                                                                                                                                                              
                                                                                                                                                                                                                 
  Partial Success Response (207 Multi-Status):                                                                                                                                                                   
  {                                                                                                                                                                                                              
    "message": "Uploaded 1 of 2 artifacts",                                                                                                                                                                      
    "artifacts": [                                                                                                                                                                                               
      {                                                                                                                                                                                                          
        "id": "artifact-uuid-1",                                                                                                                                                                                 
        "file_name": "step_001.png",                                                                                                                                                                             
        "step_number": 1,                                                                                                                                                                                        
        "download_url": "/api/v1/reports/artifacts/artifact-uuid-1/download"                                                                                                                                     
      }                                                                                                                                                                                                          
    ],                                                                                                                                                                                                           
    "failed": [                                                                                                                                                                                                  
      {                                                                                                                                                                                                          
        "file_index": 1,                                                                                                                                                                                         
        "file_name": "step_002.png",                                                                                                                                                                             
        "error": "File corrupted or unreadable"                                                                                                                                                                  
      }                                                                                                                                                                                                          
    ]                                                                                                                                                                                                            
  }                                                                                                                                                                                                              
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
  5. List Artifacts for Test Case                                                                                                                                                                                
                                                                                                                                                                                                                 
  Endpoint: GET /api/v1/reports/test-case-results/{test_case_result_id}/artifacts                                                                                                                                
                                                                                                                                                                                                                 
  Query Parameters:                                                                                                                                                                                              
  - artifact_type (optional): Filter by type (screenshot, log, etc.)                                                                                                                                             
  - step_number (optional): Filter by step number                                                                                                                                                                
  - page (optional, default: 1): Page number                                                                                                                                                                     
  - per_page (optional, default: 100): Items per page                                                                                                                                                            
                                                                                                                                                                                                                 
  Response (200 OK):                                                                                                                                                                                             
  {                                                                                                                                                                                                              
    "total": 3,                                                                                                                                                                                                  
    "page": 1,                                                                                                                                                                                                   
    "per_page": 100,                                                                                                                                                                                             
    "items": [                                                                                                                                                                                                   
      {                                                                                                                                                                                                          
        "id": "artifact-uuid-1",                                                                                                                                                                                 
        "artifact_type": "screenshot",                                                                                                                                                                           
        "file_name": "step_001_navigate.png",                                                                                                                                                                    
        "file_size": 45678,                                                                                                                                                                                      
        "mime_type": "image/png",                                                                                                                                                                                
        "step_number": 1,                                                                                                                                                                                        
        "iteration_number": 1,                                                                                                                                                                                   
        "artifact_category": "after",                                                                                                                                                                            
        "download_url": "/api/v1/reports/artifacts/artifact-uuid-1/download",                                                                                                                                    
        "captured_at": "2026-01-24T12:00:01.250Z"                                                                                                                                                                
      },                                                                                                                                                                                                         
      {                                                                                                                                                                                                          
        "id": "artifact-uuid-2",                                                                                                                                                                                 
        "artifact_type": "screenshot",                                                                                                                                                                           
        "file_name": "step_002_type.png",                                                                                                                                                                        
        "file_size": 52341,                                                                                                                                                                                      
        "mime_type": "image/png",                                                                                                                                                                                
        "step_number": 2,                                                                                                                                                                                        
        "iteration_number": 1,                                                                                                                                                                                   
        "artifact_category": "after",                                                                                                                                                                            
        "download_url": "/api/v1/reports/artifacts/artifact-uuid-2/download",                                                                                                                                    
        "captured_at": "2026-01-24T12:00:01.600Z"                                                                                                                                                                
      }                                                                                                                                                                                                          
    ]                                                                                                                                                                                                            
  }                                                                                                                                                                                                              
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
  6. Download Artifact                                                                                                                                                                                           
                                                                                                                                                                                                                 
  Endpoint: GET /api/v1/reports/artifacts/{artifact_id}/download                                                                                                                                                 
                                                                                                                                                                                                                 
  Response: Binary file with appropriate Content-Type header                                                                                                                                                     
                                                                                                                                                                                                                 
  Response Headers:                                                                                                                                                                                              
  Content-Type: image/png                                                                                                                                                                                        
  Content-Disposition: inline; filename="step_001_navigate.png"                                                                                                                                                  
  Content-Length: 45678                                                                                                                                                                                          
  Cache-Control: public, max-age=31536000                                                                                                                                                                        
                                                                                                                                                                                                                 
  Error Response (404):                                                                                                                                                                                          
  {                                                                                                                                                                                                              
    "detail": "Artifact not found"                                                                                                                                                                               
  }                                                                                                                                                                                                              
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
  7. Get Artifact Metadata                                                                                                                                                                                       
                                                                                                                                                                                                                 
  Endpoint: GET /api/v1/reports/artifacts/{artifact_id}                                                                                                                                                          
                                                                                                                                                                                                                 
  Response (200 OK):                                                                                                                                                                                             
  {                                                                                                                                                                                                              
    "id": "artifact-uuid",                                                                                                                                                                                       
    "test_case_result_id": "test-case-uuid",                                                                                                                                                                     
    "artifact_type": "screenshot",                                                                                                                                                                               
    "file_name": "step_001_navigate.png",                                                                                                                                                                        
    "file_size": 45678,                                                                                                                                                                                          
    "mime_type": "image/png",                                                                                                                                                                                    
    "checksum": "sha256-hash",                                                                                                                                                                                   
    "step_number": 1,                                                                                                                                                                                            
    "iteration_number": 1,                                                                                                                                                                                       
    "artifact_category": "after",                                                                                                                                                                                
    "description": null,                                                                                                                                                                                         
    "download_url": "/api/v1/reports/artifacts/artifact-uuid/download",                                                                                                                                          
    "captured_at": "2026-01-24T12:00:01.250Z",                                                                                                                                                                   
    "uploaded_at": "2026-01-24T12:05:00.000Z"                                                                                                                                                                    
  }                                                                                                                                                                                                              
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
  8. Link Artifact to Step (Update Step with Screenshot)                                                                                                                                                         
                                                                                                                                                                                                                 
  Endpoint: PATCH /api/v1/reports/steps/{step_id}                                                                                                                                                                
                                                                                                                                                                                                                 
  Request Body:                                                                                                                                                                                                  
  {                                                                                                                                                                                                              
    "screenshot_artifact_id": "artifact-uuid"                                                                                                                                                                    
  }                                                                                                                                                                                                              
                                                                                                                                                                                                                 
  Response (200 OK):                                                                                                                                                                                             
  {                                                                                                                                                                                                              
    "id": "step-uuid",                                                                                                                                                                                           
    "step_number": 1,                                                                                                                                                                                            
    "screenshot_artifact_id": "artifact-uuid",                                                                                                                                                                   
    "message": "Step updated successfully"                                                                                                                                                                       
  }                                                                                                                                                                                                              
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
  Server Configuration                                                                                                                                                                                           
                                                                                                                                                                                                                 
  # config.py or .env                                                                                                                                                                                            
                                                                                                                                                                                                                 
  # Artifact storage settings                                                                                                                                                                                    
  ARTIFACT_STORAGE_PATH = "/var/data/test-artifacts"  # Base path for file storage                                                                                                                               
  ARTIFACT_MAX_FILE_SIZE = 10 * 1024 * 1024  # 10MB max per file                                                                                                                                                 
  ARTIFACT_ALLOWED_TYPES = [                                                                                                                                                                                     
      "image/png",                                                                                                                                                                                               
      "image/jpeg",                                                                                                                                                                                              
      "image/gif",                                                                                                                                                                                               
      "application/json",                                                                                                                                                                                        
      "text/plain",                                                                                                                                                                                              
      "text/html",                                                                                                                                                                                               
      "application/pdf"                                                                                                                                                                                          
  ]                                                                                                                                                                                                              
  ARTIFACT_BATCH_MAX_FILES = 50  # Max files per batch upload                                                                                                                                                    
                                                                                                                                                                                                                 
  File Storage Structure                                                                                                                                                                                         
                                                                                                                                                                                                                 
  /var/data/test-artifacts/                                                                                                                                                                                      
   2026/                                                                                                                                                                                                      
      01/                                                                                                                                                                                                    
          24/                                                                                                                                                                                                
              {test_case_result_id}/                                                                                                                                                                         
                  step_001_after.png                                                                                                                                                                         
                  step_002_after.png                                                                                                                                                                         
                  step_003_error.png                                                                                                                                                                         
                  iteration_002/                                                                                                                                                                             
                      step_001_after.png                                                                                                                                                                     
                      step_002_after.png                                                                                                                                                                     
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
  Summary of Endpoints                                                                                                                                                                                           
                                                                                                                     
   Method                     Endpoint                               Description                                                                                                                             
                                                                                                                     
   POST    /reports/test-case-results/{id}/steps            Upload all steps (bulk)                                                                                                                          
                                                                                                                     
   GET     /reports/test-case-results/{id}/steps            Get all steps with artifacts                                                                                                                     
                                                                                                                     
   POST    /reports/test-case-results/{id}/artifacts        Upload single artifact                                                                                                                           
                                                                                                                     
   POST    /reports/test-case-results/{id}/artifacts/batch  Upload multiple artifacts                                                                                                                        
                                                                                                                     
   GET     /reports/test-case-results/{id}/artifacts        List all artifacts                                                                                                                               
                                                                                                                     
   GET     /reports/artifacts/{id}                          Get artifact metadata                                                                                                                            
                                                                                                                     
   GET     /reports/artifacts/{id}/download                 Download artifact file                                                                                                                           
                                                                                                                     
   PATCH   /reports/steps/{id}                              Update step (link screenshot)                                                                                                                    
                                                                                                                     
  ---                                                                                                                                                                                                            
  Client Integration Notes                                                                                                                                                                                       
                                                                                                                                                                                                                 
  The client will:                                                                                                                                                                                               
                                                                                                                                                                                                                 
  1. After test completion:                                                                                                                                                                                      
    - Parse result.json to extract step details                                                                                                                                                                  
    - Compress screenshots (PNG optimization)                                                                                                                                                                    
    - Call POST /steps with all step data                                                                                                                                                                        
    - Call POST /artifacts/batch to upload all screenshots                                                                                                                                                       
    - Call PATCH /steps/{id} to link screenshots to steps                                                                                                                                                        
  2. When viewing reports:                                                                                                                                                                                       
    - Call GET /steps?include_artifacts=true                                                                                                                                                                     
    - Use download_url from response to display screenshots                                                                                                                                                      
    - Screenshots will be loaded via <img src="/api/v1/reports/artifacts/{id}/download">                                                                                                                         
  3. Expected upload size per test:                                                                                                                                                                              
    - Steps JSON: ~5-50 KB                                                                                                                                                                                       
    - Screenshots: ~50-500 KB each (compressed)                                                                                                                                                                  
    - Typical test with 10 steps: ~1-5 MB total                                                                                                                                                                  
                                                                                                                                                                                                                 
  ---                                                                                                                                                                                                            
  Please implement these endpoints and let me know when ready. I will then implement the corresponding client-side upload and view functionality. 
